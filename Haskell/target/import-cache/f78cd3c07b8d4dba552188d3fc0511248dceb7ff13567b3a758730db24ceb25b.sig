Module("annotatebox",[Imports([Import("libstratego-gpp"),Import("libspoofax/term/annotation"),Import("libspoofax/stratego/debug")]),Signature([Constructors([OpDecl("Position",FunType([ConstType(SortNoArgs("INT")),ConstType(SortNoArgs("INT"))],ConstType(SortNoArgs("Pos")))),OpDecl("PositionWithLayout",FunType([ConstType(SortNoArgs("INT")),ConstType(SortNoArgs("INT"))],ConstType(SortNoArgs("Pos"))))])]),Rules([SDefT("annotate-box-line-col",[],[VarDec("p",ConstType(SortNoArgs("ATerm")))],SRule(Rule(As(Var("t"),NoAnnoList(Op("V",[NoAnnoList(List([NoAnnoList(Op("SOpt",[NoAnnoList(Op("VS",[])),Var("vs")]))])),NoAnnoList(List([]))]))),Var("t"),[]))),SDefT("annotate-box-line-col",[],[VarDec("p",ConstType(SortNoArgs("ATerm")))],SRule(Rule(As(Var("t"),NoAnnoList(Op("V",[NoAnnoList(List([])),NoAnnoList(List([]))]))),Var("t"),[]))),SDefT("annotate-box-line-col",[],[VarDec("p",ConstType(SortNoArgs("ATerm")))],SRule(Rule(AnnoList(Op("V",[NoAnnoList(List([NoAnnoList(Op("SOpt",[NoAnnoList(Op("VS",[])),Var("vs")]))])),AnnoList(ListTail([Var("b")],Var("bs")),[Var("l*")])]),[Var("a*")]),App(Seq(CallT(SVar("try"),[CallT(SVar("annotate-top-level-box"),[],[Var("new-list")])],[]),CallT(SVar("add-annotation"),[],[NoAnnoList(Op("PositionWithLayout",[Var("line"),Var("column")]))])),AnnoList(Op("V",[NoAnnoList(List([NoAnnoList(Op("SOpt",[NoAnnoList(Op("VS",[])),Var("vs")]))])),Var("new-list")]),[Var("a*")])),[WithClause(Seq(GuardedLChoice(Where(BA(Match(NoAnnoList(List([]))),Var("bs"))),Assign(Var("p'"),Var("p")),Assign(Var("p'"),App(Seq(CallT(SVar("get-end-position"),[],[Var("p")]),CallT(SVar("inc-line-position"),[],[App(CallT(SVar("string-to-int"),[],[]),Var("vs")),App(Match(NoAnnoList(Op("Position",[Wld,RootApp(Id)]))),Var("p"))])),Var("b")))),Seq(Assign(Var("new-list"),AnnoList(ListTail([Var("b")],App(CallT(SVar("annotate-box-line-col-vertical"),[],[Var("p'"),App(CallT(SVar("string-to-int"),[],[]),Var("vs"))]),Var("bs"))),[Var("l*")])),BA(Match(NoAnnoList(Op("Position",[Var("line"),Var("column")]))),Var("p")))))]))),SDefT("annotate-box-line-col",[],[VarDec("p",ConstType(SortNoArgs("ATerm")))],SRule(Rule(AnnoList(Op("V",[NoAnnoList(List([])),AnnoList(ListTail([Var("b")],Var("bs")),[Var("l*")])]),[Var("a*")]),App(Seq(CallT(SVar("try"),[CallT(SVar("annotate-top-level-box"),[],[Var("new-list")])],[]),CallT(SVar("add-annotation"),[],[NoAnnoList(Op("PositionWithLayout",[Var("line"),Var("column")]))])),AnnoList(Op("V",[NoAnnoList(List([])),Var("new-list")]),[Var("a*")])),[WithClause(Seq(GuardedLChoice(Where(BA(Match(NoAnnoList(List([]))),Var("bs"))),Assign(Var("p'"),Var("p")),Assign(Var("p'"),App(Seq(CallT(SVar("get-end-position"),[],[Var("p")]),CallT(SVar("inc-line-position"),[],[NoAnnoList(Int("1")),App(Match(NoAnnoList(Op("Position",[Wld,RootApp(Id)]))),Var("p"))])),Var("b")))),Seq(Assign(Var("new-list"),AnnoList(ListTail([App(CallT(SVar("annotate-box-line-col"),[],[Var("p")]),Var("b"))],App(CallT(SVar("annotate-box-line-col-vertical"),[],[Var("p'"),NoAnnoList(Int("1"))]),Var("bs"))),[Var("l*")])),BA(Match(NoAnnoList(Op("Position",[Var("line"),Var("column")]))),Var("p")))))]))),SDefT("annotate-box-line-col",[],[VarDec("p",ConstType(SortNoArgs("ATerm")))],SRule(Rule(As(Var("t"),NoAnnoList(Op("H",[NoAnnoList(List([NoAnnoList(Op("SOpt",[NoAnnoList(Op("HS",[])),Var("hs")]))])),NoAnnoList(List([]))]))),Var("t"),[]))),SDefT("annotate-box-line-col",[],[VarDec("p",ConstType(SortNoArgs("ATerm")))],SRule(Rule(As(Var("t"),NoAnnoList(Op("H",[NoAnnoList(List([])),NoAnnoList(List([]))]))),Var("t"),[]))),SDefT("annotate-box-line-col",[],[VarDec("p",ConstType(SortNoArgs("ATerm")))],SRule(Rule(As(Var("t"),AnnoList(Op("H",[NoAnnoList(List([NoAnnoList(Op("SOpt",[NoAnnoList(Op("HS",[])),Var("hs")]))])),AnnoList(ListTail([Var("b")],Var("bs")),[Var("l*")])]),[Var("a*")])),App(Seq(CallT(SVar("try"),[CallT(SVar("annotate-top-level-box"),[],[Var("new-list")])],[]),CallT(SVar("add-annotation"),[],[NoAnnoList(Op("PositionWithLayout",[Var("line"),Var("column")]))])),AnnoList(Op("H",[NoAnnoList(List([NoAnnoList(Op("SOpt",[NoAnnoList(Op("HS",[])),Var("hs")]))])),Var("new-list")]),[Var("a*")])),[WithClause(Seq(GuardedLChoice(Where(BA(Match(NoAnnoList(List([]))),Var("bs"))),Assign(Var("p'"),Var("p")),Assign(Var("p'"),App(Seq(CallT(SVar("get-end-position"),[],[Var("p")]),CallT(SVar("inc-column-position"),[],[App(CallT(SVar("string-to-int"),[],[]),Var("hs"))])),Var("b")))),Seq(Assign(Var("new-list"),AnnoList(ListTail([App(CallT(SVar("annotate-box-line-col"),[],[Var("p")]),Var("b"))],App(CallT(SVar("annotate-box-line-col-horizontal"),[],[Var("p'"),App(CallT(SVar("string-to-int"),[],[]),Var("hs"))]),Var("bs"))),[Var("l*")])),BA(Match(NoAnnoList(Op("Position",[Var("line"),Var("column")]))),Var("p")))))]))),SDefT("annotate-box-line-col",[],[VarDec("p",ConstType(SortNoArgs("ATerm")))],SRule(Rule(AnnoList(Op("H",[NoAnnoList(List([])),AnnoList(ListTail([Var("b")],Var("bs")),[Var("l*")])]),[Var("a*")]),App(Seq(CallT(SVar("try"),[CallT(SVar("annotate-top-level-box"),[],[Var("new-list")])],[]),CallT(SVar("add-annotation"),[],[NoAnnoList(Op("PositionWithLayout",[Var("line"),Var("column")]))])),AnnoList(Op("H",[NoAnnoList(List([])),Var("new-list")]),[Var("a*")])),[WithClause(Seq(GuardedLChoice(Where(BA(Match(NoAnnoList(List([]))),Var("bs"))),Assign(Var("p'"),Var("p")),Assign(Var("p'"),App(Seq(CallT(SVar("get-end-position"),[],[Var("p")]),CallT(SVar("inc-column-position"),[],[NoAnnoList(Int("1"))])),Var("b")))),Seq(Assign(Var("new-list"),AnnoList(ListTail([App(CallT(SVar("annotate-box-line-col"),[],[Var("p")]),Var("b"))],App(CallT(SVar("annotate-box-line-col-horizontal"),[],[Var("p'"),NoAnnoList(Int("1"))]),Var("bs"))),[Var("l*")])),BA(Match(NoAnnoList(Op("Position",[Var("line"),Var("column")]))),Var("p")))))]))),SDefT("annotate-box-line-col",[],[VarDec("p",ConstType(SortNoArgs("ATerm")))],SRule(Rule(AnnoList(Op("Z",[NoAnnoList(List([])),AnnoList(ListTail([Var("b")],Var("bs")),[Var("l*")])]),[Var("a*")]),App(Seq(CallT(SVar("try"),[CallT(SVar("annotate-top-level-box"),[],[Var("new-list")])],[]),CallT(SVar("add-annotation"),[],[NoAnnoList(Op("PositionWithLayout",[Var("line"),Var("column")]))])),AnnoList(Op("Z",[NoAnnoList(List([])),Var("new-list")]),[Var("a*")])),[WithClause(Seq(GuardedLChoice(Where(BA(Match(NoAnnoList(List([]))),Var("bs"))),Assign(Var("p'"),Var("p")),Assign(Var("p'"),App(Seq(CallT(SVar("get-end-position"),[],[Var("p")]),CallT(SVar("inc-line-position"),[],[NoAnnoList(Int("1"))])),Var("b")))),Seq(Assign(Var("new-list"),AnnoList(ListTail([App(CallT(SVar("annotate-box-line-col"),[],[Var("p")]),Var("b"))],App(CallT(SVar("annotate-box-line-col-vertical-z"),[],[Var("p'"),NoAnnoList(Int("1"))]),Var("bs"))),[Var("l*")])),BA(Match(NoAnnoList(Op("Position",[Var("line"),Var("column")]))),Var("p")))))]))),SDefT("annotate-box-line-col",[],[VarDec("p",ConstType(SortNoArgs("ATerm")))],SRule(Rule(As(Var("t"),NoAnnoList(Op("Z",[NoAnnoList(List([])),NoAnnoList(List([]))]))),Var("t"),[]))),SDefT("annotate-box-line-col",[],[VarDec("p",ConstType(SortNoArgs("ATerm")))],SRule(Rule(AnnoList(Op("S",[Var("string")]),[Var("a*")]),AnnoList(Op("S",[Var("string")]),[Var("a*")]),[WhereClause(BA(CallT(SVar("eq"),[],[]),NoAnnoList(Tuple([App(CallT(SVar("strlen"),[],[]),Var("string")),NoAnnoList(Int("0"))]))))]))),SDefT("annotate-box-line-col",[],[VarDec("p",ConstType(SortNoArgs("ATerm")))],SRule(Rule(AnnoList(Op("S",[Var("string")]),[Var("a*")]),App(CallT(SVar("add-annotation"),[],[Var("p")]),AnnoList(Op("S",[Var("string")]),[Var("a*")])),[WhereClause(BA(Not(CallT(SVar("eq"),[],[])),NoAnnoList(Tuple([App(CallT(SVar("strlen"),[],[]),Var("string")),NoAnnoList(Int("0"))]))))]))),SDefT("annotate-box-line-col-vertical-z",[],[VarDec("p",ConstType(SortNoArgs("ATerm"))),VarDec("vs",ConstType(SortNoArgs("ATerm")))],SRule(Rule(NoAnnoList(ListTail([Var("b")],Var("bs"))),NoAnnoList(ListTail([App(CallT(SVar("annotate-box-line-col"),[],[Var("p")]),Var("b"))],App(CallT(SVar("annotate-box-line-col-vertical-z"),[],[Var("p'"),Var("vs")]),Var("bs")))),[WithClause(Assign(Var("p'"),App(Seq(CallT(SVar("get-end-position"),[],[Var("p")]),CallT(SVar("inc-line-position"),[],[Var("vs")])),Var("b"))))]))),SDefT("annotate-box-line-col-vertical-z",[],[VarDec("p",ConstType(SortNoArgs("ATerm"))),VarDec("vs",ConstType(SortNoArgs("ATerm")))],SRule(Rule(NoAnnoList(List([])),NoAnnoList(List([])),[]))),SDefT("annotate-box-line-col-vertical",[],[VarDec("p",ConstType(SortNoArgs("ATerm"))),VarDec("vs",ConstType(SortNoArgs("ATerm")))],SRule(Rule(NoAnnoList(ListTail([Var("b")],Var("bs"))),NoAnnoList(ListTail([App(CallT(SVar("annotate-box-line-col"),[],[Var("p")]),Var("b"))],App(CallT(SVar("annotate-box-line-col-vertical"),[],[Var("p'"),Var("vs")]),Var("bs")))),[WithClause(Assign(Var("p'"),App(Seq(CallT(SVar("get-end-position"),[],[Var("p")]),CallT(SVar("inc-line-position"),[],[Var("vs"),App(Match(NoAnnoList(Op("Position",[Wld,RootApp(Id)]))),Var("p"))])),Var("b"))))]))),SDefT("annotate-box-line-col-vertical",[],[VarDec("p",ConstType(SortNoArgs("ATerm"))),VarDec("vs",ConstType(SortNoArgs("ATerm")))],SRule(Rule(NoAnnoList(List([])),NoAnnoList(List([])),[]))),SDefT("annotate-box-line-col-horizontal",[],[VarDec("p",ConstType(SortNoArgs("ATerm"))),VarDec("hs",ConstType(SortNoArgs("ATerm")))],SRule(Rule(NoAnnoList(ListTail([Var("b")],Var("bs"))),NoAnnoList(ListTail([App(CallT(SVar("annotate-box-line-col"),[],[Var("p")]),Var("b"))],App(CallT(SVar("annotate-box-line-col-horizontal"),[],[Var("p'"),Var("hs")]),Var("bs")))),[WithClause(GuardedLChoice(Where(BA(Match(NoAnnoList(List([]))),Var("bs"))),Assign(Var("p'"),Var("p")),Assign(Var("p'"),App(Seq(CallT(SVar("get-end-position"),[],[Var("p")]),CallT(SVar("inc-column-position"),[],[Var("hs")])),Var("b")))))]))),SDefT("annotate-box-line-col-horizontal",[],[VarDec("p",ConstType(SortNoArgs("ATerm"))),VarDec("hs",ConstType(SortNoArgs("ATerm")))],SRule(Rule(NoAnnoList(List([])),NoAnnoList(List([])),[]))),SDefT("inc-line-position",[],[VarDec("v",ConstType(SortNoArgs("ATerm"))),VarDec("column",ConstType(SortNoArgs("ATerm")))],SRule(Rule(NoAnnoList(Op("Position",[Var("x"),Var("y")])),NoAnnoList(Op("Position",[Var("x"),Var("y")])),[WhereClause(BA(CallT(SVar("eq"),[],[]),NoAnnoList(Tuple([Var("v"),NoAnnoList(Int("0"))]))))]))),SDefT("inc-line-position",[],[VarDec("v",ConstType(SortNoArgs("ATerm"))),VarDec("column",ConstType(SortNoArgs("ATerm")))],SRule(Rule(NoAnnoList(Op("Position",[Var("x"),Var("y")])),NoAnnoList(Op("Position",[App(CallT(SVar("addi"),[],[]),NoAnnoList(Tuple([Var("x"),Var("v")]))),Var("column")])),[WhereClause(BA(Not(CallT(SVar("eq"),[],[])),NoAnnoList(Tuple([Var("v"),NoAnnoList(Int("0"))]))))]))),SDefT("inc-line-position",[],[VarDec("v",ConstType(SortNoArgs("ATerm")))],SRule(Rule(NoAnnoList(Op("Position",[Var("x"),Var("y")])),NoAnnoList(Op("Position",[Var("x"),Var("y")])),[WhereClause(BA(CallT(SVar("eq"),[],[]),NoAnnoList(Tuple([Var("v"),NoAnnoList(Int("0"))]))))]))),SDefT("inc-line-position",[],[VarDec("v",ConstType(SortNoArgs("ATerm")))],SRule(Rule(NoAnnoList(Op("Position",[Var("x"),Var("y")])),NoAnnoList(Op("Position",[App(CallT(SVar("addi"),[],[]),NoAnnoList(Tuple([Var("x"),Var("v")]))),NoAnnoList(Int("1"))])),[WhereClause(BA(Not(CallT(SVar("eq"),[],[])),NoAnnoList(Tuple([Var("v"),NoAnnoList(Int("0"))]))))]))),SDefT("inc-column-position",[],[VarDec("v",ConstType(SortNoArgs("ATerm")))],SRule(Rule(NoAnnoList(Op("Position",[Var("x"),Var("y")])),NoAnnoList(Op("Position",[Var("x"),App(CallT(SVar("addi"),[],[]),NoAnnoList(Tuple([Var("y"),Var("v")])))])),[]))),SDefT("inc-column-position-with-layout",[],[VarDec("v",ConstType(SortNoArgs("ATerm")))],SRule(Rule(NoAnnoList(Op("PositionWithLayout",[Var("x"),Var("y")])),NoAnnoList(Op("PositionWithLayout",[Var("x"),App(CallT(SVar("addi"),[],[]),NoAnnoList(Tuple([Var("y"),Var("v")])))])),[]))),SDefT("get-end-position",[],[VarDec("p",ConstType(SortNoArgs("ATerm")))],SRule(Rule(NoAnnoList(Op("S",[Var("x")])),NoAnnoList(Op("Position",[Var("line"),App(CallT(SVar("addi"),[],[]),NoAnnoList(Tuple([Var("column"),App(CallT(SVar("string-length"),[],[]),Var("x"))])))])),[WithClause(BA(Match(NoAnnoList(Op("Position",[Var("line"),Var("column")]))),Var("p")))]))),SDefT("get-end-position",[],[VarDec("p",ConstType(SortNoArgs("ATerm")))],SRule(Rule(NoAnnoList(Op("Z",[NoAnnoList(List([])),Var("box*")])),App(CallT(SVar("get-end-position-z-list"),[],[Var("p")]),Var("box*")),[]))),SDefT("get-end-position-z-list",[],[VarDec("p",ConstType(SortNoArgs("ATerm")))],SRule(Rule(NoAnnoList(ListTail([Var("b")],Var("bs"))),App(CallT(SVar("get-end-position-z-list"),[],[Var("p'")]),Var("bs")),[WhereClause(BA(Not(Match(NoAnnoList(List([])))),Var("bs"))),WithClause(Assign(Var("p'"),App(Seq(CallT(SVar("get-end-position"),[],[Var("p")]),CallT(SVar("inc-line-position"),[],[NoAnnoList(Int("1"))])),Var("b"))))]))),SDefT("get-end-position-z-list",[],[VarDec("p",ConstType(SortNoArgs("ATerm")))],SRule(Rule(NoAnnoList(ListTail([Var("b")],Var("bs"))),App(CallT(SVar("get-end-position"),[],[Var("p")]),Var("b")),[WhereClause(BA(Match(NoAnnoList(List([]))),Var("bs")))]))),SDefT("get-end-position-z-list",[],[VarDec("p",ConstType(SortNoArgs("ATerm")))],SRule(Rule(NoAnnoList(List([])),Var("p"),[]))),SDefT("get-end-position",[],[VarDec("p",ConstType(SortNoArgs("ATerm")))],SRule(Rule(NoAnnoList(Op("H",[NoAnnoList(List([NoAnnoList(Op("SOpt",[NoAnnoList(Op("HS",[])),Var("hs")]))])),Var("box*")])),App(CallT(SVar("get-end-position-h-list"),[],[Var("p"),App(CallT(SVar("string-to-int"),[],[]),Var("hs"))]),Var("box*")),[]))),SDefT("get-end-position",[],[VarDec("p",ConstType(SortNoArgs("ATerm")))],SRule(Rule(NoAnnoList(Op("H",[NoAnnoList(List([])),Var("box*")])),App(CallT(SVar("get-end-position-h-list"),[],[Var("p"),NoAnnoList(Int("1"))]),Var("box*")),[]))),SDefT("get-end-position-h-list",[],[VarDec("p",ConstType(SortNoArgs("ATerm"))),VarDec("hs",ConstType(SortNoArgs("ATerm")))],SRule(Rule(NoAnnoList(ListTail([Var("b")],Var("bs"))),App(CallT(SVar("get-end-position-h-list"),[],[Var("p'"),Var("hs")]),Var("bs")),[WhereClause(BA(Not(Match(NoAnnoList(List([])))),Var("bs"))),WithClause(Assign(Var("p'"),App(Seq(CallT(SVar("get-end-position"),[],[Var("p")]),CallT(SVar("inc-column-position"),[],[Var("hs")])),Var("b"))))]))),SDefT("get-end-position-h-list",[],[VarDec("p",ConstType(SortNoArgs("ATerm"))),VarDec("hs",ConstType(SortNoArgs("ATerm")))],SRule(Rule(NoAnnoList(ListTail([Var("b")],Var("bs"))),App(CallT(SVar("get-end-position"),[],[Var("p")]),Var("b")),[WhereClause(BA(Match(NoAnnoList(List([]))),Var("bs")))]))),SDefT("get-end-position-h-list",[],[VarDec("p",ConstType(SortNoArgs("ATerm"))),VarDec("hs",ConstType(SortNoArgs("ATerm")))],SRule(Rule(NoAnnoList(List([])),Var("p"),[]))),SDefT("get-end-position",[],[VarDec("p",ConstType(SortNoArgs("ATerm")))],SRule(Rule(NoAnnoList(Op("V",[NoAnnoList(List([NoAnnoList(Op("SOpt",[NoAnnoList(Op("VS",[])),Var("vs")]))])),Var("box*")])),App(CallT(SVar("get-end-position-v-list"),[],[Var("p"),App(CallT(SVar("string-to-int"),[],[]),Var("vs"))]),Var("box*")),[]))),SDefT("get-end-position",[],[VarDec("p",ConstType(SortNoArgs("ATerm")))],SRule(Rule(NoAnnoList(Op("V",[NoAnnoList(List([])),Var("box*")])),App(CallT(SVar("get-end-position-v-list"),[],[Var("p"),NoAnnoList(Int("1"))]),Var("box*")),[]))),SDefT("get-end-position-v-list",[],[VarDec("p",ConstType(SortNoArgs("ATerm"))),VarDec("vs",ConstType(SortNoArgs("ATerm")))],SRule(Rule(NoAnnoList(ListTail([Var("b")],Var("bs"))),App(CallT(SVar("get-end-position-v-list"),[],[Var("p'"),Var("vs")]),Var("bs")),[WhereClause(BA(Not(Match(NoAnnoList(List([])))),Var("bs"))),WithClause(Assign(Var("p'"),App(Seq(CallT(SVar("get-end-position"),[],[Var("p")]),CallT(SVar("inc-line-position"),[],[Var("vs"),App(Match(NoAnnoList(Op("Position",[Wld,RootApp(Id)]))),Var("p"))])),Var("b"))))]))),SDefT("get-end-position-v-list",[],[VarDec("p",ConstType(SortNoArgs("ATerm"))),VarDec("vs",ConstType(SortNoArgs("ATerm")))],SRule(Rule(NoAnnoList(ListTail([Var("b")],Var("bs"))),App(CallT(SVar("get-end-position"),[],[Var("p")]),Var("b")),[WhereClause(BA(Match(NoAnnoList(List([]))),Var("bs")))]))),SDefT("annotate-top-level-box-replace",[],[VarDec("subterm",ConstType(SortNoArgs("ATerm")))],SRule(Rule(AnnoList(Var("t"),[Var("a*")]),App(CallT(SVar("replace-annotation"),[Match(NoAnnoList(Op("Position",[Wld,Wld])))],[Var("position")]),AnnoList(Var("t"),[Var("a*")])),[WhereClause(Assign(Var("position"),App(CallT(SVar("get-first-position"),[],[]),Var("subterm"))))]))),SDefT("annotate-top-level-box",[],[VarDec("subterm",ConstType(SortNoArgs("ATerm")))],SRule(Rule(AnnoList(Var("t"),[Var("a*")]),App(CallT(SVar("add-annotation"),[],[Var("position")]),AnnoList(Var("t"),[Var("a*")])),[WhereClause(Assign(Var("position"),App(CallT(SVar("get-first-position"),[],[]),Var("subterm"))))]))),SDefT("get-first-position",[],[],GuardedLChoice(CallT(SVar("collect-one"),[CallT(SVar("get-position-string"),[],[])],[]),Id,Seq(CallT(SVar("debug"),[Build(NoAnnoList(Str("\"couldn't find a term with positions \"")))],[]),Fail))),SDefT("get-position-string",[],[],SRule(Rule(AnnoList(Op("S",[Wld]),[Var("a*")]),Var("p"),[WhereClause(Assign(Var("p"),App(CallT(SVar("fetch-elem"),[Match(NoAnnoList(Op("Position",[Wld,Wld])))],[]),Var("a*"))))])))])])