Module("annotatebox",[Imports([Import("libstratego-gpp"),Import("libspoofax/term/annotation"),Import("libspoofax/stratego/debug")]),Signature([Constructors([OpDecl("Position",FunType([ConstType(SortNoArgs("INT")),ConstType(SortNoArgs("INT"))],ConstType(SortNoArgs("Pos")))),OpDecl("PositionWithLayout",FunType([ConstType(SortNoArgs("INT")),ConstType(SortNoArgs("INT"))],ConstType(SortNoArgs("Pos"))))])]),Rules([RDefT("annotate-box-line-col",[],[DefaultVarDec("p")],RuleNoCond(As(Var("t"),NoAnnoList(Op("V",[NoAnnoList(List([NoAnnoList(Op("SOpt",[NoAnnoList(Op("VS",[])),Var("vs")]))])),NoAnnoList(List([]))]))),Var("t"))),RDefT("annotate-box-line-col",[],[DefaultVarDec("p")],RuleNoCond(As(Var("t"),NoAnnoList(Op("V",[NoAnnoList(List([])),NoAnnoList(List([]))]))),Var("t"))),RDefT("annotate-box-line-col",[],[DefaultVarDec("p")],Rule(AnnoList(Op("V",[NoAnnoList(List([NoAnnoList(Op("SOpt",[NoAnnoList(Op("VS",[])),Var("vs")]))])),AnnoList(ListTail([Var("b")],Var("bs")),[Var(ListVar("l*"))])]),[Var(ListVar("a*"))]),App(Seq(Call(SVar("try"),[CallT(SVar("annotate-top-level-box"),[],[Var("new-list")])]),CallT(SVar("add-annotation"),[],[NoAnnoList(Op("PositionWithLayout",[Var("line"),Var("column")]))])),AnnoList(Op("V",[NoAnnoList(List([NoAnnoList(Op("SOpt",[NoAnnoList(Op("VS",[])),Var("vs")]))])),Var("new-list")]),[Var(ListVar("a*"))])),[WithClause(Seq(CondChoice(BA(Match(NoAnnoList(List([]))),Var("bs")),Assign(Var("p'"),Var("p")),Assign(Var("p'"),App(Seq(CallT(SVar("get-end-position"),[],[Var("p")]),CallT(SVar("inc-line-position"),[],[App(CallNoArgs(SVar("string-to-int")),Var("vs")),App(Match(NoAnnoList(Op("Position",[Wld,RootApp(Id)]))),Var("p"))])),Var("b")))),Seq(Assign(Var("new-list"),AnnoList(ListTail([Var("b")],App(CallT(SVar("annotate-box-line-col-vertical"),[],[Var("p'"),App(CallNoArgs(SVar("string-to-int")),Var("vs"))]),Var("bs"))),[Var(ListVar("l*"))])),BA(Match(NoAnnoList(Op("Position",[Var("line"),Var("column")]))),Var("p")))))])),RDefT("annotate-box-line-col",[],[DefaultVarDec("p")],Rule(AnnoList(Op("V",[NoAnnoList(List([])),AnnoList(ListTail([Var("b")],Var("bs")),[Var(ListVar("l*"))])]),[Var(ListVar("a*"))]),App(Seq(Call(SVar("try"),[CallT(SVar("annotate-top-level-box"),[],[Var("new-list")])]),CallT(SVar("add-annotation"),[],[NoAnnoList(Op("PositionWithLayout",[Var("line"),Var("column")]))])),AnnoList(Op("V",[NoAnnoList(List([])),Var("new-list")]),[Var(ListVar("a*"))])),[WithClause(Seq(CondChoice(BA(Match(NoAnnoList(List([]))),Var("bs")),Assign(Var("p'"),Var("p")),Assign(Var("p'"),App(Seq(CallT(SVar("get-end-position"),[],[Var("p")]),CallT(SVar("inc-line-position"),[],[NoAnnoList(Int("1")),App(Match(NoAnnoList(Op("Position",[Wld,RootApp(Id)]))),Var("p"))])),Var("b")))),Seq(Assign(Var("new-list"),AnnoList(ListTail([App(CallT(SVar("annotate-box-line-col"),[],[Var("p")]),Var("b"))],App(CallT(SVar("annotate-box-line-col-vertical"),[],[Var("p'"),NoAnnoList(Int("1"))]),Var("bs"))),[Var(ListVar("l*"))])),BA(Match(NoAnnoList(Op("Position",[Var("line"),Var("column")]))),Var("p")))))])),RDefT("annotate-box-line-col",[],[DefaultVarDec("p")],RuleNoCond(As(Var("t"),NoAnnoList(Op("H",[NoAnnoList(List([NoAnnoList(Op("SOpt",[NoAnnoList(Op("HS",[])),Var("hs")]))])),NoAnnoList(List([]))]))),Var("t"))),RDefT("annotate-box-line-col",[],[DefaultVarDec("p")],RuleNoCond(As(Var("t"),NoAnnoList(Op("H",[NoAnnoList(List([])),NoAnnoList(List([]))]))),Var("t"))),RDefT("annotate-box-line-col",[],[DefaultVarDec("p")],Rule(As(Var("t"),AnnoList(Op("H",[NoAnnoList(List([NoAnnoList(Op("SOpt",[NoAnnoList(Op("HS",[])),Var("hs")]))])),AnnoList(ListTail([Var("b")],Var("bs")),[Var(ListVar("l*"))])]),[Var(ListVar("a*"))])),App(Seq(Call(SVar("try"),[CallT(SVar("annotate-top-level-box"),[],[Var("new-list")])]),CallT(SVar("add-annotation"),[],[NoAnnoList(Op("PositionWithLayout",[Var("line"),Var("column")]))])),AnnoList(Op("H",[NoAnnoList(List([NoAnnoList(Op("SOpt",[NoAnnoList(Op("HS",[])),Var("hs")]))])),Var("new-list")]),[Var(ListVar("a*"))])),[WithClause(Seq(CondChoice(BA(Match(NoAnnoList(List([]))),Var("bs")),Assign(Var("p'"),Var("p")),Assign(Var("p'"),App(Seq(CallT(SVar("get-end-position"),[],[Var("p")]),CallT(SVar("inc-column-position"),[],[App(CallNoArgs(SVar("string-to-int")),Var("hs"))])),Var("b")))),Seq(Assign(Var("new-list"),AnnoList(ListTail([App(CallT(SVar("annotate-box-line-col"),[],[Var("p")]),Var("b"))],App(CallT(SVar("annotate-box-line-col-horizontal"),[],[Var("p'"),App(CallNoArgs(SVar("string-to-int")),Var("hs"))]),Var("bs"))),[Var(ListVar("l*"))])),BA(Match(NoAnnoList(Op("Position",[Var("line"),Var("column")]))),Var("p")))))])),RDefT("annotate-box-line-col",[],[DefaultVarDec("p")],Rule(AnnoList(Op("H",[NoAnnoList(List([])),AnnoList(ListTail([Var("b")],Var("bs")),[Var(ListVar("l*"))])]),[Var(ListVar("a*"))]),App(Seq(Call(SVar("try"),[CallT(SVar("annotate-top-level-box"),[],[Var("new-list")])]),CallT(SVar("add-annotation"),[],[NoAnnoList(Op("PositionWithLayout",[Var("line"),Var("column")]))])),AnnoList(Op("H",[NoAnnoList(List([])),Var("new-list")]),[Var(ListVar("a*"))])),[WithClause(Seq(CondChoice(BA(Match(NoAnnoList(List([]))),Var("bs")),Assign(Var("p'"),Var("p")),Assign(Var("p'"),App(Seq(CallT(SVar("get-end-position"),[],[Var("p")]),CallT(SVar("inc-column-position"),[],[NoAnnoList(Int("1"))])),Var("b")))),Seq(Assign(Var("new-list"),AnnoList(ListTail([App(CallT(SVar("annotate-box-line-col"),[],[Var("p")]),Var("b"))],App(CallT(SVar("annotate-box-line-col-horizontal"),[],[Var("p'"),NoAnnoList(Int("1"))]),Var("bs"))),[Var(ListVar("l*"))])),BA(Match(NoAnnoList(Op("Position",[Var("line"),Var("column")]))),Var("p")))))])),RDefT("annotate-box-line-col",[],[DefaultVarDec("p")],Rule(AnnoList(Op("Z",[NoAnnoList(List([])),AnnoList(ListTail([Var("b")],Var("bs")),[Var(ListVar("l*"))])]),[Var(ListVar("a*"))]),App(Seq(Call(SVar("try"),[CallT(SVar("annotate-top-level-box"),[],[Var("new-list")])]),CallT(SVar("add-annotation"),[],[NoAnnoList(Op("PositionWithLayout",[Var("line"),Var("column")]))])),AnnoList(Op("Z",[NoAnnoList(List([])),Var("new-list")]),[Var(ListVar("a*"))])),[WithClause(Seq(CondChoice(BA(Match(NoAnnoList(List([]))),Var("bs")),Assign(Var("p'"),Var("p")),Assign(Var("p'"),App(Seq(CallT(SVar("get-end-position"),[],[Var("p")]),CallT(SVar("inc-line-position"),[],[NoAnnoList(Int("1"))])),Var("b")))),Seq(Assign(Var("new-list"),AnnoList(ListTail([App(CallT(SVar("annotate-box-line-col"),[],[Var("p")]),Var("b"))],App(CallT(SVar("annotate-box-line-col-vertical-z"),[],[Var("p'"),NoAnnoList(Int("1"))]),Var("bs"))),[Var(ListVar("l*"))])),BA(Match(NoAnnoList(Op("Position",[Var("line"),Var("column")]))),Var("p")))))])),RDefT("annotate-box-line-col",[],[DefaultVarDec("p")],RuleNoCond(As(Var("t"),NoAnnoList(Op("Z",[NoAnnoList(List([])),NoAnnoList(List([]))]))),Var("t"))),RDefT("annotate-box-line-col",[],[DefaultVarDec("p")],Rule(AnnoList(Op("S",[Var("string")]),[Var(ListVar("a*"))]),AnnoList(Op("S",[Var("string")]),[Var(ListVar("a*"))]),BA(CallNoArgs(SVar("eq")),NoAnnoList(Tuple([App(CallNoArgs(SVar("strlen")),Var("string")),NoAnnoList(Int("0"))]))))),RDefT("annotate-box-line-col",[],[DefaultVarDec("p")],Rule(AnnoList(Op("S",[Var("string")]),[Var(ListVar("a*"))]),App(CallT(SVar("add-annotation"),[],[Var("p")]),AnnoList(Op("S",[Var("string")]),[Var(ListVar("a*"))])),BA(Not(CallNoArgs(SVar("eq"))),NoAnnoList(Tuple([App(CallNoArgs(SVar("strlen")),Var("string")),NoAnnoList(Int("0"))]))))),RDefT("annotate-box-line-col-vertical-z",[],[DefaultVarDec("p"),DefaultVarDec("vs")],Rule(NoAnnoList(ListTail([Var("b")],Var("bs"))),NoAnnoList(ListTail([App(CallT(SVar("annotate-box-line-col"),[],[Var("p")]),Var("b"))],App(CallT(SVar("annotate-box-line-col-vertical-z"),[],[Var("p'"),Var("vs")]),Var("bs")))),[WithClause(Assign(Var("p'"),App(Seq(CallT(SVar("get-end-position"),[],[Var("p")]),CallT(SVar("inc-line-position"),[],[Var("vs")])),Var("b"))))])),RDefT("annotate-box-line-col-vertical-z",[],[DefaultVarDec("p"),DefaultVarDec("vs")],RuleNoCond(NoAnnoList(List([])),NoAnnoList(List([])))),RDefT("annotate-box-line-col-vertical",[],[DefaultVarDec("p"),DefaultVarDec("vs")],Rule(NoAnnoList(ListTail([Var("b")],Var("bs"))),NoAnnoList(ListTail([App(CallT(SVar("annotate-box-line-col"),[],[Var("p")]),Var("b"))],App(CallT(SVar("annotate-box-line-col-vertical"),[],[Var("p'"),Var("vs")]),Var("bs")))),[WithClause(Assign(Var("p'"),App(Seq(CallT(SVar("get-end-position"),[],[Var("p")]),CallT(SVar("inc-line-position"),[],[Var("vs"),App(Match(NoAnnoList(Op("Position",[Wld,RootApp(Id)]))),Var("p"))])),Var("b"))))])),RDefT("annotate-box-line-col-vertical",[],[DefaultVarDec("p"),DefaultVarDec("vs")],RuleNoCond(NoAnnoList(List([])),NoAnnoList(List([])))),RDefT("annotate-box-line-col-horizontal",[],[DefaultVarDec("p"),DefaultVarDec("hs")],Rule(NoAnnoList(ListTail([Var("b")],Var("bs"))),NoAnnoList(ListTail([App(CallT(SVar("annotate-box-line-col"),[],[Var("p")]),Var("b"))],App(CallT(SVar("annotate-box-line-col-horizontal"),[],[Var("p'"),Var("hs")]),Var("bs")))),[WithClause(CondChoice(BA(Match(NoAnnoList(List([]))),Var("bs")),Assign(Var("p'"),Var("p")),Assign(Var("p'"),App(Seq(CallT(SVar("get-end-position"),[],[Var("p")]),CallT(SVar("inc-column-position"),[],[Var("hs")])),Var("b")))))])),RDefT("annotate-box-line-col-horizontal",[],[DefaultVarDec("p"),DefaultVarDec("hs")],RuleNoCond(NoAnnoList(List([])),NoAnnoList(List([])))),RDefT("inc-line-position",[],[DefaultVarDec("v"),DefaultVarDec("column")],Rule(NoAnnoList(Op("Position",[Var("x"),Var("y")])),NoAnnoList(Op("Position",[Var("x"),Var("y")])),BA(CallNoArgs(SVar("eq")),NoAnnoList(Tuple([Var("v"),NoAnnoList(Int("0"))]))))),RDefT("inc-line-position",[],[DefaultVarDec("v"),DefaultVarDec("column")],Rule(NoAnnoList(Op("Position",[Var("x"),Var("y")])),NoAnnoList(Op("Position",[App(CallNoArgs(SVar("addi")),NoAnnoList(Tuple([Var("x"),Var("v")]))),Var("column")])),BA(Not(CallNoArgs(SVar("eq"))),NoAnnoList(Tuple([Var("v"),NoAnnoList(Int("0"))]))))),RDefT("inc-line-position",[],[DefaultVarDec("v")],Rule(NoAnnoList(Op("Position",[Var("x"),Var("y")])),NoAnnoList(Op("Position",[Var("x"),Var("y")])),BA(CallNoArgs(SVar("eq")),NoAnnoList(Tuple([Var("v"),NoAnnoList(Int("0"))]))))),RDefT("inc-line-position",[],[DefaultVarDec("v")],Rule(NoAnnoList(Op("Position",[Var("x"),Var("y")])),NoAnnoList(Op("Position",[App(CallNoArgs(SVar("addi")),NoAnnoList(Tuple([Var("x"),Var("v")]))),NoAnnoList(Int("1"))])),BA(Not(CallNoArgs(SVar("eq"))),NoAnnoList(Tuple([Var("v"),NoAnnoList(Int("0"))]))))),RDefT("inc-column-position",[],[DefaultVarDec("v")],RuleNoCond(NoAnnoList(Op("Position",[Var("x"),Var("y")])),NoAnnoList(Op("Position",[Var("x"),App(CallNoArgs(SVar("addi")),NoAnnoList(Tuple([Var("y"),Var("v")])))])))),RDefT("inc-column-position-with-layout",[],[DefaultVarDec("v")],RuleNoCond(NoAnnoList(Op("PositionWithLayout",[Var("x"),Var("y")])),NoAnnoList(Op("PositionWithLayout",[Var("x"),App(CallNoArgs(SVar("addi")),NoAnnoList(Tuple([Var("y"),Var("v")])))])))),RDefT("get-end-position",[],[DefaultVarDec("p")],Rule(NoAnnoList(Op("S",[Var("x")])),NoAnnoList(Op("Position",[Var("line"),App(CallNoArgs(SVar("addi")),NoAnnoList(Tuple([Var("column"),App(CallNoArgs(SVar("string-length")),Var("x"))])))])),[WithClause(BA(Match(NoAnnoList(Op("Position",[Var("line"),Var("column")]))),Var("p")))])),RDefT("get-end-position",[],[DefaultVarDec("p")],RuleNoCond(NoAnnoList(Op("Z",[NoAnnoList(List([])),Var(ListVar("box*"))])),App(CallT(SVar("get-end-position-z-list"),[],[Var("p")]),Var(ListVar("box*"))))),RDefT("get-end-position-z-list",[],[DefaultVarDec("p")],Rule(NoAnnoList(ListTail([Var("b")],Var("bs"))),App(CallT(SVar("get-end-position-z-list"),[],[Var("p'")]),Var("bs")),[WhereClause(BA(Not(Match(NoAnnoList(List([])))),Var("bs"))),WithClause(Assign(Var("p'"),App(Seq(CallT(SVar("get-end-position"),[],[Var("p")]),CallT(SVar("inc-line-position"),[],[NoAnnoList(Int("1"))])),Var("b"))))])),RDefT("get-end-position-z-list",[],[DefaultVarDec("p")],Rule(NoAnnoList(ListTail([Var("b")],Var("bs"))),App(CallT(SVar("get-end-position"),[],[Var("p")]),Var("b")),BA(Match(NoAnnoList(List([]))),Var("bs")))),RDefT("get-end-position-z-list",[],[DefaultVarDec("p")],RuleNoCond(NoAnnoList(List([])),Var("p"))),RDefT("get-end-position",[],[DefaultVarDec("p")],RuleNoCond(NoAnnoList(Op("H",[NoAnnoList(List([NoAnnoList(Op("SOpt",[NoAnnoList(Op("HS",[])),Var("hs")]))])),Var(ListVar("box*"))])),App(CallT(SVar("get-end-position-h-list"),[],[Var("p"),App(CallNoArgs(SVar("string-to-int")),Var("hs"))]),Var(ListVar("box*"))))),RDefT("get-end-position",[],[DefaultVarDec("p")],RuleNoCond(NoAnnoList(Op("H",[NoAnnoList(List([])),Var(ListVar("box*"))])),App(CallT(SVar("get-end-position-h-list"),[],[Var("p"),NoAnnoList(Int("1"))]),Var(ListVar("box*"))))),RDefT("get-end-position-h-list",[],[DefaultVarDec("p"),DefaultVarDec("hs")],Rule(NoAnnoList(ListTail([Var("b")],Var("bs"))),App(CallT(SVar("get-end-position-h-list"),[],[Var("p'"),Var("hs")]),Var("bs")),[WhereClause(BA(Not(Match(NoAnnoList(List([])))),Var("bs"))),WithClause(Assign(Var("p'"),App(Seq(CallT(SVar("get-end-position"),[],[Var("p")]),CallT(SVar("inc-column-position"),[],[Var("hs")])),Var("b"))))])),RDefT("get-end-position-h-list",[],[DefaultVarDec("p"),DefaultVarDec("hs")],Rule(NoAnnoList(ListTail([Var("b")],Var("bs"))),App(CallT(SVar("get-end-position"),[],[Var("p")]),Var("b")),BA(Match(NoAnnoList(List([]))),Var("bs")))),RDefT("get-end-position-h-list",[],[DefaultVarDec("p"),DefaultVarDec("hs")],RuleNoCond(NoAnnoList(List([])),Var("p"))),RDefT("get-end-position",[],[DefaultVarDec("p")],RuleNoCond(NoAnnoList(Op("V",[NoAnnoList(List([NoAnnoList(Op("SOpt",[NoAnnoList(Op("VS",[])),Var("vs")]))])),Var(ListVar("box*"))])),App(CallT(SVar("get-end-position-v-list"),[],[Var("p"),App(CallNoArgs(SVar("string-to-int")),Var("vs"))]),Var(ListVar("box*"))))),RDefT("get-end-position",[],[DefaultVarDec("p")],RuleNoCond(NoAnnoList(Op("V",[NoAnnoList(List([])),Var(ListVar("box*"))])),App(CallT(SVar("get-end-position-v-list"),[],[Var("p"),NoAnnoList(Int("1"))]),Var(ListVar("box*"))))),RDefT("get-end-position-v-list",[],[DefaultVarDec("p"),DefaultVarDec("vs")],Rule(NoAnnoList(ListTail([Var("b")],Var("bs"))),App(CallT(SVar("get-end-position-v-list"),[],[Var("p'"),Var("vs")]),Var("bs")),[WhereClause(BA(Not(Match(NoAnnoList(List([])))),Var("bs"))),WithClause(Assign(Var("p'"),App(Seq(CallT(SVar("get-end-position"),[],[Var("p")]),CallT(SVar("inc-line-position"),[],[Var("vs"),App(Match(NoAnnoList(Op("Position",[Wld,RootApp(Id)]))),Var("p"))])),Var("b"))))])),RDefT("get-end-position-v-list",[],[DefaultVarDec("p"),DefaultVarDec("vs")],Rule(NoAnnoList(ListTail([Var("b")],Var("bs"))),App(CallT(SVar("get-end-position"),[],[Var("p")]),Var("b")),BA(Match(NoAnnoList(List([]))),Var("bs")))),RDefT("annotate-top-level-box-replace",[],[DefaultVarDec("subterm")],Rule(AnnoList(Var("t"),[Var(ListVar("a*"))]),App(CallT(SVar("replace-annotation"),[Match(NoAnnoList(Op("Position",[Wld,Wld])))],[Var("position")]),AnnoList(Var("t"),[Var(ListVar("a*"))])),Assign(Var("position"),App(CallNoArgs(SVar("get-first-position")),Var("subterm"))))),RDefT("annotate-top-level-box",[],[DefaultVarDec("subterm")],Rule(AnnoList(Var("t"),[Var(ListVar("a*"))]),App(CallT(SVar("add-annotation"),[],[Var("position")]),AnnoList(Var("t"),[Var(ListVar("a*"))])),Assign(Var("position"),App(CallNoArgs(SVar("get-first-position")),Var("subterm"))))),SDefNoArgs("get-first-position",LChoice(Call(SVar("collect-one"),[CallNoArgs(SVar("get-position-string"))]),Seq(Call(SVar("debug"),[Build(NoAnnoList(Str("\"couldn't find a term with positions \"")))]),Fail))),RDefNoArgs("get-position-string",Rule(AnnoList(Op("S",[Wld]),[Var(ListVar("a*"))]),Var("p"),Assign(Var("p"),App(Call(SVar("fetch-elem"),[Match(NoAnnoList(Op("Position",[Wld,Wld])))]),Var(ListVar("a*"))))))])])